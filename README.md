# Moodboard & Palette

画像をドラッグ＆ドロップするだけで **代表色パレット抽出 / タグ自動生成 / PNG書き出し** を行う、**単一HTMLファイル**のシングルページアプリです。インストール不要・依存なし・オフラインOK（ブラウザだけ）。

> **学びのねらい**：Canvas の `getImageData`、`FileReader` による画像読み込み、`toDataURL` による画像出力、ルールベースのテキスト生成。

---

## 目次

* [デモ](#デモ)
* [クイックスタート](#クイックスタート)
* [使い方](#使い方)
* [機能](#機能)
* [フォルダ構成](#フォルダ構成)
* [仕組み（アルゴリズム）](#仕組みアルゴリズム)
* [タグ生成ルール](#タグ生成ルール)
* [自然言語の色名（HSL→日本語）](#自然言語の色名hsl日本語)
* [カスタマイズ](#カスタマイズ)
* [アクセシビリティ](#アクセシビリティ)
* [パフォーマンス](#パフォーマンス)
* [ブラウザ対応](#ブラウザ対応)
* [トラブルシューティング](#トラブルシューティング)
* [FAQ](#faq)
* [ライセンス](#ライセンス)

---

## デモ

* `index.html` をブラウザで開くだけで動作します（オフライン可）。
* VS Code の **Live Server** で開くとクリップボードやドラッグ&ドロップが安定します。

> 参考URL例（環境によりポートは異なります）：`http://localhost:5500/index.html`

---

## クイックスタート

1. 任意の空フォルダ（例：`moodboard-palette`）を作成
   ※ **スペースや記号を入れない**（`^`, `&`, 日本語 など）。
2. フォルダ内に **`index.html`** を作り、このリポジトリの `index.html` の中身を **まるごと貼り付け**。
3. VS Codeで `index.html` を **右クリック → Open with Live Server**（または `Go Live`）
4. ブラウザが開いたら、中央の枠に画像を **ドラッグ＆ドロップ**。複数OK。
   **Ctrl/⌘ + V** で貼り付け、**ボタン**でファイル選択も可。

---

## 使い方

* 読み込むと、画像ごとに **カード** が生成されます。

  * 上：画像プレビュー
  * 中：**5色のスウォッチ**（クリックで HEX コピー）
  * 下：**自動タグ**（例：ビビッド／パステル／クール／高コントラスト 等）
* **PNG書き出し**：

  * カード右下「**PNG書き出し**」→ **そのカード**を画像保存
  * 画面右上「**ボードをPNG書き出し**」→ **全カード**を1枚画像にまとめて保存
* **リセット**：右上「リセット」で全カード削除

> **中学生でもOKポイント**：ドラッグして離す→色が出る、ボタンを押す→保存できる。むずかしい設定は不要！

---

## 機能

* 画像のドラッグ&ドロップ／ペースト／複数選択
* Canvas `getImageData` によるピクセル解析
* k-means（k=5, k-means++風初期化）で代表色クラスタリング
* 類似色の重複排除＆ライトネス優先ソート
* HSL→日本語の色名（「やわらかい青」「深い緑」など）
* ルールベースのタグ生成（ビビッド／パステル／モノトーン／クール／あたたかい／ナチュラル／高コントラスト 等）
* HEXコピー（クリック）
* カード/ボードの PNG エクスポート
* モダンUI（ダークテーマ、角丸、影、トースト通知）

---

## フォルダ構成

単一ファイル構成：

```
moodboard-palette/
└─ index.html   # HTML/CSS/JS すべて内包
```

---

## 仕組み（アルゴリズム）

### 1) 前処理

* 画像を **最大 420×420** まで縮小してキャンバスに描画（処理軽量化）
* 透明ピクセル（α<10）は無視
* サンプリング数が多い場合は **~12,000px** まで間引き（動的 `step`）

### 2) 代表色抽出（k-means）

* クラスタ数 **k=5**、反復 **最大12回**
* **k-means++風** に初期重心を選び、ユークリッド距離で割当→平均で更新
* 各クラスタのピクセル数で比率を記録

### 3) 重複排除と整列

* 近い色（RGB距離 **< 18**）は重複として除外
* 各色に HSL を付与し、**ライトネス→ヒュー**の順で安定ソート

### 4) 表示と書き出し

* スウォッチ上の文字色は背景の相対輝度で自動選択
* 書き出し時は **オフスクリーンCanvas** にカード要素を再描画→`toDataURL('image/png')`

---

## タグ生成ルール

各カードの 5 色から統計値を計算し、以下の条件を満たしたタグを最大6件付与します。

* **ビビッド**：平均彩度 `S̄ > 0.62`
* **パステル**：`S̄ < 0.28` かつ 平均明度 `L̄ > 0.60`
* **モノトーン**：無彩色（`S < 0.06`）の色が **50%超**
* **あたたかい**：赤・橙・黄の比率 **> 0.55**
* **クール**：緑・青・紫の比率 **> 0.55**
* **ナチュラル**：緑 **> 0.35** かつ 青 **> 0.15**
* **エネルギッシュ**：赤+橙 **> 0.45**
* **高コントラスト**：最大と最小の相対輝度差 **> 0.55**
* **やわらかいトーン**：上記に該当しない場合のデフォルト
* **明るい**：`L̄ > 0.70`
* **ダーク**：`L̄ < 0.30`

> しきい値は `index.html` 内の関数 `generateTags` で調整できます。

---

## 自然言語の色名（HSL→日本語）

* 無彩色（`S < 0.06`）：

  * `L > 0.9` → **ホワイト系**
  * `L < 0.1` → **ブラック系**
  * その他 → **グレー系**
* 有彩色：形容詞＋基本色名

  * 形容詞は HSL から推定（例）

    * `S > 0.72` かつ `0.35 < L < 0.75` → **鮮やかな**
    * `S < 0.32` かつ `L ≥ 0.35` → **やわらかい**
    * `L > 0.82` → **明るい**
    * `L < 0.28` → **深い**
    * `Hue ∈ [0,60) ∪ [330,360)` → **あたたかい**
    * `Hue ∈ [180,280)` → **クールな**
  * 基本色名は Hue の区間で判定（赤/オレンジ/黄色/黄緑/緑/青緑/青/藍/紫/赤紫）

---

## カスタマイズ

`index.html` の該当箇所を変更するだけで調整できます。

* **代表色の数**：`kmeansColors(data, /*k=*/5, 12)` の `k` を変更（3〜8 推奨）
* **反復回数**：第3引数（既定 12）
* **縮小サイズ**：`const maxW = 420, maxH = 420;`
* **重複しきい値**：`const delta = 18;`
* **テーマ色**：`:root` の CSS カスタムプロパティ（`--bg`, `--panel`, `--accent` など）
* **書き出し解像度**：`exportCardPNG` / `exportBoardPNG` 内のキャンバス `width` / `height`

---

## アクセシビリティ

* スウォッチのラベル色は相対輝度（WCAG）に基づき自動で白/濃色を切替。
* 将来的には **コントラスト比**（4.5:1 など）の数値表示や、配色の警告も追加可能です。

---

## パフォーマンス

* 画像は最大 420px 四方へ縮小して解析。
* ピクセルサンプリングを約 12,000 点まで動的に間引き。
* k-means は 12 反復で打ち切り（多くの画像で収束十分）。
* これらによりスマホでも快適に動作します。

---

## ブラウザ対応

* 最新の **Chrome / Edge / Firefox / Safari** で動作確認。
* クリップボードAPIは **ユーザー操作**（クリック等）が必要。`localhost` は安全なコンテキストとして扱われるため、Live Server 推奨。

---

## トラブルシューティング

* **Cannot GET /.../index.html** と出る：

  * フォルダ名に **スペースや記号**（`^`, `&`, 日本語 等）が入っていないか
  * `index.html` がそのパスに **実在**するか
  * VS Code では **`index.html` を右クリック → Open with Live Server`** で起動
* **画像が読み込めない**：ファイル拡張子が画像か確認（`png/jpg/webp` 等）。
* **コピーできない**：ブラウザの権限/HTTPS/ユーザー操作を確認。Live Server 推奨。
* **色が極端に少ない**：透過や真っ白/真っ黒の画像は代表色が偏ることがあります。別画像で確認してください。

---

## FAQ

**Q. 代表色はなぜ 5 色？**
A. 情報量と見やすさのバランス。`k` を変えれば 3〜8 色などにも対応可能です。

**Q. k-means の代わりに Median Cut などは？**
A. 実装は容易ですが、ここでは「似ている色の中心」を得やすい k-means を採用。差し替えは可能です。

**Q. 書き出しPNGのサイズを大きくしたい**
A. `exportCardPNG` / `exportBoardPNG` の `width/height` を上げてください。テキスト倍率も忘れずに。

**Q. ダークではなくライトUIにしたい**
A. `:root` のカラー変数を調整するだけでOKです。

---

## ライセンス

* MIT License（必要に応じてご自身の著作権表記を追記してください）

---

## クレジット / 謝辞

* フォント：Inter / Noto Sans JP（Google Fonts）
* 企画・実装：あなた（学習・制作用途で自由に改変してください）
